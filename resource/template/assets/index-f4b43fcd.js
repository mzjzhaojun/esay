import{_ as A,g as O,r as _,t as T,f as j,h as E,o as M,a as r,b as V,c as b,w as s,e as m,d as l,i as v,u as f,j as y,k as Q,p as W,l as D}from"./index-995db30f.js";const G=(i,o,c)=>!o||o.length<6?c(new Error("密码最少6位")):c();const H=i=>(W("data-v-4f14a6e5"),i=i(),D(),i),J={class:"flex-c-center-center bg-color-white",style:{height:"400px",width:"500px","border-radius":"10px"}},K={class:"m-t-20"},X=H(()=>m("h1",{class:"font-size-base",style:{"padding-bottom":"20px","padding-left":"100px"}},"后台管理系统",-1)),Y={style:{"text-align":"center"}},Z={__name:"index",setup(i){const{proxy:o}=O();let c=o.$store.user.useUserStore();const{init:k,verCaptcha:F,login:C,getCaptcha:U}=c,t=_({});let u=_(!1),h=_(""),p=_();const{orcode:x,versu:q}=T(c),S={username:[{required:!0,trigger:"change",message:"请输入账号"}],password:[{required:!0,trigger:"change",validator:G}]};j(async()=>{}),E(()=>o.$router.currentRoute.value,n=>{console.log("路由变化：",n.path)},{immediate:!0}),M(async()=>{k()});function I(){o.$refs.loginFormRef.validate(n=>{n&&C(t.value).then(()=>{let e=o.$route.fullPath;if(e.startsWith("/login?redirect=")){let d=e.replace("/login?redirect=","");o.$router.push({path:d})}else o.$router.push({path:"/"})})})}function R(){t.value.username!=null?U(t.value).then(()=>{h.value="qrcode",u.value=!0}):o.submitInfo("请输入账号!")}function N(){let n=x.value.toString(),e=n.substring(n.indexOf("=")+1,n.length);t.value.code=p,t.value.twocode=e,F(t.value).then(()=>{q.value==1?(h.value="qrcode",u.value=!1,o.submitOk("绑定成功")):o.submitFail("验证码错误!")})}return(n,e)=>{const d=r("base-input-no"),g=r("el-form-item"),P=r("el-link"),$=r("el-form"),w=r("el-button"),B=r("base-qrcode"),L=r("base-dialog"),z=r("base-wrapper");return V(),b(z,{class:"flex-center-center",style:{"background-color":"#FFFFFF"}},{default:s(()=>[m("div",J,[m("div",K,[X,l($,{ref:"loginFormRef",model:t.value,rules:S},{default:s(()=>[l(g,{prop:"username"},{default:s(()=>[l(d,{modelValue:t.value.username,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.username=a),"prefix-icon":"User",placeholder:"请输入账号",maxlength:"30"},null,8,["modelValue"])]),_:1}),l(g,{prop:"password"},{default:s(()=>[l(d,{modelValue:t.value.password,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.password=a),"prefix-icon":"Lock",placeholder:"请输入密码","show-password":"",maxlength:"30"},null,8,["modelValue"])]),_:1}),l(g,{prop:"code"},{default:s(()=>[l(d,{modelValue:t.value.code,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.code=a),"prefix-icon":"Lock",placeholder:"请输入Authenticator验证码",maxlength:"6"},null,8,["modelValue"]),l(P,{type:"primary",onClick:R},{default:s(()=>[v("绑定&更新")]),_:1})]),_:1})]),_:1},8,["model"]),l(w,{type:"primary",style:{width:"300px"},onClick:I},{default:s(()=>[v("登 录")]),_:1})])]),f(h)==="qrcode"?(V(),b(L,{key:0,modelValue:f(u),"onUpdate:modelValue":e[4]||(e[4]=a=>y(u)?u.value=a:u=a),title:"绑定账号"+t.value.username,width:"15%"},{default:s(()=>[m("div",Y,[l(B,{value:f(x),size:"200"},null,8,["value"])]),m("span",null,[l(d,{modelValue:f(p),"onUpdate:modelValue":e[3]||(e[3]=a=>y(p)?p.value=a:p=a),placeholder:"请使用Authenticator扫码后显示的验证码",maxlength:"6"},null,8,["modelValue"]),l(w,{type:"primary",class:"m-t-10 w-full",onClick:N},{default:s(()=>[v("确定绑定")]),_:1})])]),_:1},8,["modelValue","title"])):Q("",!0)]),_:1})}}},te=A(Z,[["__scopeId","data-v-4f14a6e5"]]);export{te as default};
