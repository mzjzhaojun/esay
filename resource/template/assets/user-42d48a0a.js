import{g as de,t as re,r as c,o as ie,a as u,v as pe,b as r,c as i,w as o,d as a,u as t,x as q,i as f,n as D,k as y,e as F,j as U,m as me,F as _e,q as be}from"./index-995db30f.js";const fe=["src"],we={__name:"user",setup(ce){const{proxy:p}=de();let x=p.$store.user.useUserStore(),{logout:S}=x,{userObj:j}=re(x),n=c(!1),m=c({}),s=c({}),k=c({}),v=c(""),I=c("123456"),B=c({username:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,pattern:/^(\w){6,16}$/,message:"请设置6-16位字母、数字组合",trigger:"blur"}],nickname:[{required:!0,message:"请输入你昵称",trigger:"blur"}],roleIdList:[{required:!0,message:"请选择角色",trigger:"blur"}]}),E=c({password:[{required:!0,message:"请输入更新密码",trigger:"blur"}]}),N=c([]);ie(()=>{M()});async function M(){let d=await p.$api.sys_dept.tree();N.value=d.body}function Q(d){m.value.dept_id=d.id,V()}async function V(){p.$refs.baseTableRef.refresh()}function z(){s.value={sex:0,dept_id:m.value.dept_id},v.value="add",n.value=!0}function A(d){s.value=Object.assign({},d),s.value.password=null,v.value="update",n.value=!0}async function G(d){let l=await p.$api.sys_user.delete(d);p.submitOk(l.messge),V()}async function H(d){k.value={id:d.id,version:d.version},v.value="updatePwd",I.value="123456",n.value=!0}async function J(){p.$refs.dataNewPasswordRef.validate(async d=>{if(d){let l=await p.$api.sys_user.resetpassword(k.value);p.submitOk(l.msg,()=>{W()}),n.value=!1}})}function K(){p.$refs.dataFormRef.validate(async d=>{if(d){let l=await p.$api.sys_user[s.value.id?"update":"add"](s.value);p.submitOk(l.msg),V(),n.value=!1}})}function W(){s.value.id===j.value.id&&S()}return(d,l)=>{const X=u("el-tree"),Y=u("base-card"),$=u("base-cascader"),C=u("base-input"),w=u("el-button"),Z=u("base-header"),b=u("el-table-column"),P=u("el-tag"),ee=u("base-delete-btn"),le=u("base-table-p"),ae=u("base-content"),te=u("base-card-no"),g=u("base-input-no"),_=u("el-form-item"),h=u("el-form"),O=u("base-dialog"),R=u("base-select"),oe=u("el-option"),se=u("el-select"),ne=u("base-upload-single"),ue=u("base-wrapper"),L=pe("has-perm");return r(),i(ue,{class:"flex"},{default:o(()=>[a(Y,{title:"组织架构",style:{width:"200px"}},{default:o(()=>[a(X,{data:t(N),props:{children:"children",label:"name"},"highlight-current":"","default-expand-all":"","expand-on-click-node":!1,onNodeClick:Q},null,8,["data"])]),_:1}),a(te,{title:"用户管理",class:"flex-1"},{default:o(()=>[a(Z,null,{default:o(()=>[a($,{modelValue:t(m).dept_id,"onUpdate:modelValue":l[0]||(l[0]=e=>t(m).dept_id=e),style:{"margin-right":"10px"},clearable:"",label:"企业",props:{value:"id",label:"name",children:"children",checkStrictly:!0,emitPath:!1},api:"sys_dept.tree"},null,8,["modelValue"]),a(C,{modelValue:t(m).username,"onUpdate:modelValue":l[1]||(l[1]=e=>t(m).username=e),label:"账号",onClear:V},null,8,["modelValue"]),a(C,{modelValue:t(m).nickname,"onUpdate:modelValue":l[2]||(l[2]=e=>t(m).nickname=e),label:"名称 ",onClear:V},null,8,["modelValue"]),a(C,{modelValue:t(m).phone,"onUpdate:modelValue":l[3]||(l[3]=e=>t(m).phone=e),label:"手机号",onClear:V},null,8,["modelValue"]),q((r(),i(w,{type:"primary",onClick:V},{default:o(()=>[f("查询")]),_:1})),[[L,"sys:user:page"]]),q((r(),i(w,{type:"success",onClick:z},{default:o(()=>[f("添加")]),_:1})),[[L,"sys:user:add"]])]),_:1}),a(ae,null,{default:o(()=>[a(le,{ref:"baseTableRef",api:"sys_user.listPage",params:t(m),indexCode:!0},{default:o(()=>[a(b,{"show-overflow-tooltip":!0,prop:"username",label:"用户账号"}),a(b,{prop:"nickname",label:"用户名称"}),a(b,{prop:"sexName",label:"性别"}),a(b,{prop:"phone",label:"手机号码"}),a(b,{prop:"email",label:"邮箱"}),a(b,{prop:"accounttypename",label:"账户类型"},{default:o(e=>[e.row.accounttypename?(r(),i(P,{key:0,type:"success"},{default:o(()=>[f(D(e.row.accounttypename),1)]),_:2},1024)):y("",!0)]),_:1}),a(b,{label:"角色","show-overflow-tooltip":!0},{default:o(e=>[e.row.roleNames?(r(),i(P,{key:0},{default:o(()=>[f(D(e.row.roleNames),1)]),_:2},1024)):y("",!0)]),_:1}),a(b,{label:"头像",prop:"avatarUrl"},{default:o(e=>[F("span",null,[F("img",{src:e.row.avatar_url,alt:"",class:"img-sm"},null,8,fe)])]),_:1}),a(b,{"show-overflow-tooltip":!0,prop:"deptName",label:"归属企业"}),a(b,{label:"操作",width:"230"},{default:o(e=>[a(w,{link:"",onClick:T=>A(e.row)},{default:o(()=>[f("编辑")]),_:2},1032,["onClick"]),e.row.isFixed?y("",!0):(r(),i(ee,{key:0,onOk:T=>G(e.row.id)},null,8,["onOk"])),a(w,{link:"",onClick:T=>H(e.row)},{default:o(()=>[f("更新密码")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["params"])]),_:1})]),_:1}),t(v)==="updatePwd"?(r(),i(O,{key:0,modelValue:t(n),"onUpdate:modelValue":l[7]||(l[7]=e=>U(n)?n.value=e:n=e),title:d.dialogTitleObj[t(v)],width:"25%"},{footer:o(()=>[a(w,{onClick:l[5]||(l[5]=e=>U(n)?n.value=!1:n=!1)},{default:o(()=>[f("取消")]),_:1}),a(w,{type:"primary",onClick:l[6]||(l[6]=e=>J())},{default:o(()=>[f("确定")]),_:1})]),default:o(()=>[a(h,{ref:"dataNewPasswordRef",model:t(k),rules:t(E),"label-width":"80px"},{default:o(()=>[a(_,{label:"密码:",prop:"password"},{default:o(()=>[a(g,{modelValue:t(k).password,"onUpdate:modelValue":l[4]||(l[4]=e=>t(k).password=e),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])):(r(),i(O,{key:1,modelValue:t(n),"onUpdate:modelValue":l[19]||(l[19]=e=>U(n)?n.value=e:n=e),title:d.dialogTitleObj[t(v)],width:"23%"},{footer:o(()=>[a(w,{onClick:l[18]||(l[18]=e=>U(n)?n.value=!1:n=!1)},{default:o(()=>[f("取消")]),_:1}),a(w,{type:"primary",onClick:K},{default:o(()=>[f("确定")]),_:1})]),default:o(()=>[a(h,{ref:"dataFormRef",model:t(s),rules:t(B),"label-width":"80px"},{default:o(()=>[a(_,{label:"账号:",prop:"username"},{default:o(()=>[a(g,{modelValue:t(s).username,"onUpdate:modelValue":l[8]||(l[8]=e=>t(s).username=e),disabled:t(v)!="add"},null,8,["modelValue","disabled"])]),_:1}),t(v)==="add"?(r(),i(_,{key:0,label:"密码:",prop:"password"},{default:o(()=>[a(g,{modelValue:t(s).password,"onUpdate:modelValue":l[9]||(l[9]=e=>t(s).password=e)},null,8,["modelValue"])]),_:1})):y("",!0),a(_,{label:"昵称:",prop:"nickname"},{default:o(()=>[a(g,{modelValue:t(s).nickname,"onUpdate:modelValue":l[10]||(l[10]=e=>t(s).nickname=e)},null,8,["modelValue"])]),_:1}),a(_,{label:"角色:",prop:"roleIdList"},{default:o(()=>[t(n)?(r(),i(R,{key:0,modelValue:t(s).roleIdList,"onUpdate:modelValue":l[11]||(l[11]=e=>t(s).roleIdList=e),"tag-type":"warning",multiple:"",style:{width:"100%"},"option-props":{label:"name",value:"id"},api:"sys_role.list"},null,8,["modelValue"])):y("",!0)]),_:1}),a(_,{label:"性别:",prop:"sex"},{default:o(()=>[a(se,{modelValue:t(s).sex,"onUpdate:modelValue":l[12]||(l[12]=e=>t(s).sex=e),placeholder:"请选择"},{default:o(()=>[(r(!0),me(_e,null,be(d.sexList,e=>(r(),i(oe,{key:e.value,label:e.name,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(_,{label:"手机号码:",prop:"phone"},{default:o(()=>[a(g,{modelValue:t(s).phone,"onUpdate:modelValue":l[13]||(l[13]=e=>t(s).phone=e),oninput:"value=value.replace(/[^\\d]/g,'')"},null,8,["modelValue"])]),_:1}),a(_,{label:"邮箱:",prop:"email"},{default:o(()=>[a(g,{modelValue:t(s).email,"onUpdate:modelValue":l[14]||(l[14]=e=>t(s).email=e)},null,8,["modelValue"])]),_:1}),a(_,{label:"头像:",prop:"avatarUrl"},{default:o(()=>[a(ne,{modelValue:t(s).avatar_url,"onUpdate:modelValue":l[15]||(l[15]=e=>t(s).avatar_url=e)},null,8,["modelValue"])]),_:1}),a(_,{label:"归属企业:"},{default:o(()=>[t(n)?(r(),i($,{key:0,modelValue:t(s).dept_id,"onUpdate:modelValue":l[16]||(l[16]=e=>t(s).dept_id=e),clearable:"",style:{width:"100%"},placeholder:"请选择",props:{value:"id",label:"name",children:"children",checkStrictly:!0,emitPath:!1},api:"sys_dept.tree"},null,8,["modelValue"])):y("",!0)]),_:1}),a(_,{label:"岗位:",prop:"post_idlist"},{default:o(()=>[t(n)?(r(),i(R,{key:0,modelValue:t(s).post_idlist,"onUpdate:modelValue":l[17]||(l[17]=e=>t(s).post_idlist=e),"tag-type":"success",style:{width:"100%"},multiple:"",clearable:"","option-props":{label:"name",value:"id"},api:"sys_post.list"},null,8,["modelValue"])):y("",!0)]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]))]),_:1})}}};export{we as default};
