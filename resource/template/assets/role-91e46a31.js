import{g as G,t as J,r as V,o as K,a as d,b as i,c as m,w as a,d as l,u as n,i as u,n as F,k,j as R,m as W}from"./index-fc37d5dd.js";const X={key:0},ee={__name:"role",setup(Y){const{proxy:_}=G();let{userObj:j}=J(_.$store.user.useUserStore()),o=V({}),s=V(!1),v=V({}),S={code:[{required:!0,message:"请输入角色编码",trigger:"blur"}],name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]},w=V(""),C=V([]);K(()=>{y()});async function y(){let r=await _.$api.sys_role.list(v.value);C.value=r.body.records}function q(){_.$refs.roleFormRef.validate(async r=>{if(r){(!o.value.parent_id||!isFinite(o.value.parent_id))&&(o.value.parent_id=0);let t=await _.$api.sys_role[o.value.id?"update":"add"](o.value);_.submitOk(t.msg),y(),s.value=!1}})}function B(r){o.value=Object.assign({},r),s.value=!0,w.value="update"}function x(r){o.value={parent_id:r,is_fixed:!1,status:1,is_refresh_all_tenant:!1,sort:100},s.value=!0,w.value="add"}async function D(r){let t=await _.$api.sys_role.delete(r);_.submitOk(t.msg),y()}function g(r){return j.value.accounttype==1||!r.is_fixed&&!["super_admin"].includes(r.code)}return(r,t)=>{const N=d("base-input"),p=d("el-button"),T=d("base-header"),f=d("el-table-column"),U=d("el-tag"),h=d("base-tag"),I=d("router-link"),P=d("base-delete-btn"),E=d("base-table"),H=d("base-content"),L=d("base-cascader"),c=d("el-form-item"),$=d("base-input-no"),O=d("base-radio-group"),M=d("el-input-number"),Q=d("el-form"),z=d("base-dialog"),A=d("base-wrapper");return i(),m(A,null,{default:a(()=>[l(T,null,{default:a(()=>[l(N,{modelValue:n(v).name,"onUpdate:modelValue":t[0]||(t[0]=e=>n(v).name=e),clearable:"",label:"角色名称",onClear:y},null,8,["modelValue"]),l(p,{type:"primary",onClick:y},{default:a(()=>[u("查询")]),_:1}),l(p,{type:"success",onClick:t[1]||(t[1]=e=>x(0))},{default:a(()=>[u("添加")]),_:1})]),_:1}),l(H,null,{default:a(()=>[l(E,{"row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},data:n(C),"default-expand-all":""},{default:a(()=>[l(f,{prop:"name",label:"角色名"}),l(f,{prop:"code",label:"角色编码"},{default:a(e=>[e.row.is_fixed?(i(),m(U,{key:0,type:"success"},{default:a(()=>[u(F(e.row.code),1)]),_:2},1024)):(i(),m(U,{key:1,type:"info"},{default:a(()=>[u(F(e.row.code),1)]),_:2},1024))]),_:1}),l(f,{prop:"code",label:"固定角色"},{default:a(e=>[l(h,{modelValue:e.row.is_fixed,"onUpdate:modelValue":b=>e.row.is_fixed=b,"data-type":"yes"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(f,{prop:"code",label:"同步更新角色权限"},{default:a(e=>[l(h,{modelValue:e.row.is_refresh_all_tenant,"onUpdate:modelValue":b=>e.row.is_refresh_all_tenant=b,"data-type":"yes"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(f,{prop:"sort",label:"排序"}),l(f,{label:"操作",width:"230"},{default:a(e=>[g(e.row)?(i(),m(p,{key:0,type:"success",link:"",onClick:b=>B(e.row)},{default:a(()=>[u("编辑")]),_:2},1032,["onClick"])):k("",!0),l(p,{type:"primary",link:"",onClick:b=>x(e.row.id)},{default:a(()=>[u("新增子项")]),_:2},1032,["onClick"]),l(I,{to:{path:"/system/role-edit",query:{id:e.row.id}}},{default:a(()=>[g(e.row)?(i(),m(p,{key:0,type:"warning",link:""},{default:a(()=>[u("权限")]),_:1})):k("",!0)]),_:2},1032,["to"]),g(e.row)?(i(),m(P,{key:1,onOk:b=>D(e.row.id)},null,8,["onOk"])):k("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),l(z,{modelValue:n(s),"onUpdate:modelValue":t[9]||(t[9]=e=>R(s)?s.value=e:s=e),title:r.dialogTitleObj[n(w)],width:"23%"},{footer:a(()=>[l(p,{onClick:t[8]||(t[8]=e=>R(s)?s.value=!1:s=!1)},{default:a(()=>[u("取 消")]),_:1}),l(p,{type:"primary",onClick:q},{default:a(()=>[u("确 定")]),_:1})]),default:a(()=>[l(Q,{ref:"roleFormRef",model:n(o),rules:n(S),"label-width":"100px"},{default:a(()=>[l(c,{label:"父角色："},{default:a(()=>[n(s)?(i(),m(L,{key:0,modelValue:n(o).parent_id,"onUpdate:modelValue":t[2]||(t[2]=e=>n(o).parent_id=e),clearable:"",style:{width:"100%"},params:{excludeRoleId:n(o).id},placeholder:"请选择(为空时标识顶级)",props:{value:"id",label:"name",children:"children",checkStrictly:!0,emitPath:!1},api:"sys_role.tree"},null,8,["modelValue","params"])):k("",!0)]),_:1}),l(c,{label:"角色名：",prop:"name"},{default:a(()=>[l($,{modelValue:n(o).name,"onUpdate:modelValue":t[3]||(t[3]=e=>n(o).name=e),placeholder:"请输入角色名"},null,8,["modelValue"])]),_:1}),l(c,{label:"角色编码：",prop:"code"},{default:a(()=>[l($,{modelValue:n(o).code,"onUpdate:modelValue":t[4]||(t[4]=e=>n(o).code=e),disabled:n(o).id!=null,placeholder:"请输入角色编码"},null,8,["modelValue","disabled"])]),_:1}),n(o).parent_id==0?(i(),W("div",X,[l(c,{label:"固定角色:"},{default:a(()=>[l(O,{modelValue:n(o).is_fixed,"onUpdate:modelValue":t[5]||(t[5]=e=>n(o).is_fixed=e),"data-type":"yes"},null,8,["modelValue"])]),_:1}),l(c,{label:"同步更新权限:"},{default:a(()=>[l(O,{modelValue:n(o).is_refresh_all_tenant,"onUpdate:modelValue":t[6]||(t[6]=e=>n(o).is_refresh_all_tenant=e),"data-type":"yes"},null,8,["modelValue"])]),_:1})])):k("",!0),l(c,{label:"排序：",prop:"sort"},{default:a(()=>[l(M,{modelValue:n(o).sort,"onUpdate:modelValue":t[7]||(t[7]=e=>n(o).sort=e),min:10,"controls-position":"right",placeholder:"请输入排序"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])]),_:1})}}};export{ee as default};
