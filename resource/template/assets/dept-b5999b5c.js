import{g as G,r as m,o as H,a as d,b as C,c as U,w as n,d as a,u as l,i as _,j as A,k as L,m as J}from"./index-b2871155.js";const K={key:0},Y={__name:"dept",setup(W){const{proxy:b}=G();let V=m({}),e=m({}),u=m(!1),y=m(""),i=m(!1),x=m({name:[{required:!0,message:"名称不得为空",trigger:"blur"}]}),g=m([]);H(()=>{c()});async function c(){let s=await b.$api.sys_dept.tree(V.value);g.value=s.body}function w(s){e.value={parent_id:s,status:!0,sort:100},y.value="add",u.value=!0,i.value=!1}function N(s){e.value=Object.assign({},s),e.value.provinceCityAreaList=[e.value.provinceName,e.value.cityName,e.value.areaName],y.value="update",u.value=!0,i.value=!1}function $(s){e.value=Object.assign({},s),e.value.provinceCityAreaList=[e.value.provinceName,e.value.cityName,e.value.areaName],y.value="detail",u.value=!0,i.value=!0}async function D(s){let o=await b.$api.sys_dept.delete(s.id);c(),b.submitOk(o.message)}function O(){b.$refs.appDataFormRef.validate(async s=>{if(s){e.value.provinceCityAreaList&&(e.value.province_name=e.value.provinceCityAreaList[0],e.value.provinceCityAreaList.length>1&&(e.value.city_name=e.value.provinceCityAreaList[1],e.value.area_name=e.value.provinceCityAreaList[2])),(!e.value.parent_id||!isFinite(e.value.parent_id))&&(e.value.parent_id=0);let o=await b.$api.sys_dept[e.value.id?"update":"add"](e.value);b.submitOk(o.message),c(),u.value=!1}})}return(s,o)=>{const j=d("base-input"),p=d("el-button"),F=d("base-header"),v=d("el-table-column"),h=d("base-tag"),B=d("base-delete-btn"),R=d("base-table"),T=d("base-content"),I=d("base-cascader"),r=d("el-form-item"),k=d("base-input-no"),S=d("base-select"),q=d("base-radio-group"),E=d("province-city-area"),M=d("el-input-number"),P=d("el-form"),Q=d("base-dialog"),z=d("base-wrapper");return C(),U(z,null,{default:n(()=>[a(F,null,{default:n(()=>[a(j,{modelValue:l(V).name,"onUpdate:modelValue":o[0]||(o[0]=t=>l(V).name=t),label:"名称",onClear:c},null,8,["modelValue"]),a(p,{type:"primary",onClick:c},{default:n(()=>[_("查询")]),_:1}),a(p,{type:"success",onClick:o[1]||(o[1]=t=>w(0))},{default:n(()=>[_("添加")]),_:1})]),_:1}),a(T,null,{default:n(()=>[a(R,{"row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},data:l(g),"default-expand-all":""},{default:n(()=>[a(v,{label:"名称",prop:"name"}),a(v,{label:"状态"},{default:n(t=>[a(h,{modelValue:t.row.status,"onUpdate:modelValue":f=>t.row.status=f},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(v,{label:"排序",prop:"sort"}),a(v,{label:"创建时间",prop:"create_time"}),a(v,{label:"操作"},{default:n(t=>[a(p,{link:"",onClick:f=>N(t.row)},{default:n(()=>[_("编辑")]),_:2},1032,["onClick"]),a(p,{type:"primary",link:"",onClick:f=>w(t.row.id)},{default:n(()=>[_("新增子项")]),_:2},1032,["onClick"]),a(p,{link:"",type:"primary",onClick:f=>$(t.row)},{default:n(()=>[_("详情")]),_:2},1032,["onClick"]),a(B,{onOk:f=>D(t.row)},null,8,["onOk"])]),_:1})]),_:1},8,["data"])]),_:1}),a(Q,{modelValue:l(u),"onUpdate:modelValue":o[11]||(o[11]=t=>A(u)?u.value=t:u=t),title:s.dialogTitleObj[l(y)],width:"23%"},{footer:n(()=>[a(p,{onClick:o[10]||(o[10]=t=>A(u)?u.value=!1:u=!1)},{default:n(()=>[_("取 消")]),_:1}),a(p,{type:"primary",onClick:O},{default:n(()=>[_("确 定")]),_:1})]),default:n(()=>[a(P,{ref:"appDataFormRef",inline:!1,model:l(e),rules:l(x),"label-width":"100px"},{default:n(()=>[a(r,{label:"父部门:"},{default:n(()=>[l(u)?(C(),U(I,{key:0,modelValue:l(e).parent_id,"onUpdate:modelValue":o[2]||(o[2]=t=>l(e).parent_id=t),clearable:"",params:{excludeDeptId:l(e).id},placeholder:"请选择(为空时标识顶级)",props:{value:"id",label:"name",children:"children",checkStrictly:!0,emitPath:!1},api:"sys_dept.tree"},null,8,["modelValue","params"])):L("",!0)]),_:1}),a(r,{label:"名称:",prop:"name"},{default:n(()=>[a(k,{modelValue:l(e).name,"onUpdate:modelValue":o[3]||(o[3]=t=>l(e).name=t),disabled:l(i)},null,8,["modelValue","disabled"])]),_:1}),a(r,{label:"负责人:"},{default:n(()=>[a(S,{modelValue:l(e).leader_user_id,"onUpdate:modelValue":o[4]||(o[4]=t=>l(e).leader_user_id=t),disabled:l(i),clearable:"","option-props":{label:"nickname",value:"id"},api:"sys_user.list"},null,8,["modelValue","disabled"])]),_:1}),a(r,{label:"状态:"},{default:n(()=>[a(q,{modelValue:l(e).status,"onUpdate:modelValue":o[5]||(o[5]=t=>l(e).status=t),disabled:l(i)},null,8,["modelValue","disabled"])]),_:1}),l(e).parent_id==0?(C(),J("div",K,[a(r,{label:"所属地区:"},{default:n(()=>[a(E,{modelValue:l(e).provinceCityAreaList,"onUpdate:modelValue":o[6]||(o[6]=t=>l(e).provinceCityAreaList=t),disabled:l(i)},null,8,["modelValue","disabled"])]),_:1}),a(r,{label:"详细地址:"},{default:n(()=>[a(k,{modelValue:l(e).address,"onUpdate:modelValue":o[7]||(o[7]=t=>l(e).address=t),disabled:l(i)},null,8,["modelValue","disabled"])]),_:1})])):L("",!0),a(r,{label:"排序:"},{default:n(()=>[a(M,{modelValue:l(e).sort,"onUpdate:modelValue":o[8]||(o[8]=t=>l(e).sort=t),min:1,disabled:l(i),"controls-position":"right",placeholder:"请输入排序"},null,8,["modelValue","disabled"])]),_:1}),a(r,{label:"备注:"},{default:n(()=>[a(k,{modelValue:l(e).remark,"onUpdate:modelValue":o[9]||(o[9]=t=>l(e).remark=t),rows:2,disabled:l(i),type:"textarea",style:{width:"300px"}},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])]),_:1})}}};export{Y as default};
