import{g as A,t as G,r as V,o as J,a as d,b as p,c as b,w as a,d as l,u as n,i as u,n as F,k,j as R,m as K}from"./index-fc9417a1.js";const W={key:0},Z={__name:"role",setup(X){const{proxy:i}=A();G(i.$store.user.useUserStore());let o=V({}),s=V(!1),w=V({}),S={code:[{required:!0,message:"请输入角色编码",trigger:"blur"}],name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]},g=V(""),v=V([]);J(()=>{y()});async function y(){let r=await i.$api.sys_role.list(w.value);v.value=r.body.records}function j(){i.$refs.roleFormRef.validate(async r=>{if(r){(!o.value.parent_id||!isFinite(o.value.parent_id))&&(o.value.parent_id=0);let t=await i.$api.sys_role[o.value.id?"update":"add"](o.value);i.submitOk(t.msg),y(),s.value=!1}})}function q(r){o.value=Object.assign({},r),s.value=!0,g.value="update"}function C(r){o.value={parent_id:r,is_fixed:!1,status:1,is_refresh_all_tenant:!1,sort:100},s.value=!0,g.value="add"}async function B(r){let t=await i.$api.sys_role.delete(r);i.submitOk(t.msg),y()}function x(r){return!["super_admin"].includes(r.code)}return(r,t)=>{const D=d("base-input"),_=d("el-button"),N=d("base-header"),m=d("el-table-column"),U=d("el-tag"),h=d("base-tag"),T=d("router-link"),I=d("base-delete-btn"),P=d("base-table"),E=d("base-content"),H=d("base-cascader"),f=d("el-form-item"),$=d("base-input-no"),O=d("base-radio-group"),L=d("el-input-number"),M=d("el-form"),Q=d("base-dialog"),z=d("base-wrapper");return p(),b(z,null,{default:a(()=>[l(N,null,{default:a(()=>[l(D,{modelValue:n(w).name,"onUpdate:modelValue":t[0]||(t[0]=e=>n(w).name=e),clearable:"",label:"角色名称",onClear:y},null,8,["modelValue"]),l(_,{type:"primary",onClick:y},{default:a(()=>[u("查询")]),_:1}),l(_,{type:"success",onClick:t[1]||(t[1]=e=>C(0))},{default:a(()=>[u("添加")]),_:1})]),_:1}),l(E,null,{default:a(()=>[l(P,{"row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},data:n(v),"default-expand-all":""},{default:a(()=>[l(m,{prop:"name",label:"角色名"}),l(m,{prop:"code",label:"角色编码"},{default:a(e=>[e.row.is_fixed?(p(),b(U,{key:0,type:"success"},{default:a(()=>[u(F(e.row.code),1)]),_:2},1024)):(p(),b(U,{key:1,type:"info"},{default:a(()=>[u(F(e.row.code),1)]),_:2},1024))]),_:1}),l(m,{prop:"code",label:"固定角色"},{default:a(e=>[l(h,{modelValue:e.row.is_fixed,"onUpdate:modelValue":c=>e.row.is_fixed=c,"data-type":"yes"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{prop:"code",label:"同步更新角色权限"},{default:a(e=>[l(h,{modelValue:e.row.is_refresh_all_tenant,"onUpdate:modelValue":c=>e.row.is_refresh_all_tenant=c,"data-type":"yes"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(m,{prop:"sort",label:"排序"}),l(m,{label:"操作",width:"230"},{default:a(e=>[x(e.row)?(p(),b(_,{key:0,type:"success",link:"",onClick:c=>q(e.row)},{default:a(()=>[u("编辑")]),_:2},1032,["onClick"])):k("",!0),l(_,{type:"primary",link:"",onClick:c=>C(e.row.id)},{default:a(()=>[u("新增子项")]),_:2},1032,["onClick"]),l(T,{to:{path:"/system/role-edit",query:{id:e.row.id}}},{default:a(()=>[l(_,{type:"warning",link:""},{default:a(()=>[u("权限")]),_:1})]),_:2},1032,["to"]),x(e.row)?(p(),b(I,{key:1,onOk:c=>B(e.row.id)},null,8,["onOk"])):k("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),l(Q,{modelValue:n(s),"onUpdate:modelValue":t[9]||(t[9]=e=>R(s)?s.value=e:s=e),title:r.dialogTitleObj[n(g)],width:"20%"},{footer:a(()=>[l(_,{onClick:t[8]||(t[8]=e=>R(s)?s.value=!1:s=!1)},{default:a(()=>[u("取 消")]),_:1}),l(_,{type:"primary",onClick:j},{default:a(()=>[u("确 定")]),_:1})]),default:a(()=>[l(M,{ref:"roleFormRef",model:n(o),rules:n(S),"label-width":"100px"},{default:a(()=>[l(f,{label:"父角色："},{default:a(()=>[n(s)?(p(),b(H,{key:0,modelValue:n(o).parent_id,"onUpdate:modelValue":t[2]||(t[2]=e=>n(o).parent_id=e),clearable:"",style:{width:"100%"},params:{excludeRoleId:n(o).id},placeholder:"请选择(为空时标识顶级)",props:{value:"id",label:"name",children:"children",checkStrictly:!0,emitPath:!1},api:"sys_role.tree"},null,8,["modelValue","params"])):k("",!0)]),_:1}),l(f,{label:"角色名：",prop:"name"},{default:a(()=>[l($,{modelValue:n(o).name,"onUpdate:modelValue":t[3]||(t[3]=e=>n(o).name=e),placeholder:"请输入角色名"},null,8,["modelValue"])]),_:1}),l(f,{label:"角色编码：",prop:"code"},{default:a(()=>[l($,{modelValue:n(o).code,"onUpdate:modelValue":t[4]||(t[4]=e=>n(o).code=e),disabled:n(o).id!=null,placeholder:"请输入角色编码"},null,8,["modelValue","disabled"])]),_:1}),n(o).parent_id==0?(p(),K("div",W,[l(f,{label:"固定角色:"},{default:a(()=>[l(O,{modelValue:n(o).is_fixed,"onUpdate:modelValue":t[5]||(t[5]=e=>n(o).is_fixed=e),"data-type":"yes"},null,8,["modelValue"])]),_:1}),l(f,{label:"同步更新权限:"},{default:a(()=>[l(O,{modelValue:n(o).is_refresh_all_tenant,"onUpdate:modelValue":t[6]||(t[6]=e=>n(o).is_refresh_all_tenant=e),"data-type":"yes"},null,8,["modelValue"])]),_:1})])):k("",!0),l(f,{label:"排序：",prop:"sort"},{default:a(()=>[l(L,{modelValue:n(o).sort,"onUpdate:modelValue":t[7]||(t[7]=e=>n(o).sort=e),min:10,"controls-position":"right",placeholder:"请输入排序"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])]),_:1})}}};export{Z as default};
