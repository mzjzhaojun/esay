import{g as se,t as ue,r as y,o as de,a as u,v as re,b as r,c as i,w as o,d as a,u as t,x as j,i as f,n as D,k as w,e as F,j as U,m as ie,F as pe,q as me}from"./index-fc9417a1.js";const _e=["src"],ce={__name:"user",setup(be){const{proxy:m}=se();let x=m.$store.user.useUserStore(),{logout:R}=x,{userObj:S}=ue(x),s=y(!1),p=y({}),n=y({}),c=y(""),g=y("123456"),q=y({username:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,pattern:/^(\w){6,16}$/,message:"请设置6-16位字母、数字组合",trigger:"blur"}],nickname:[{required:!0,message:"请输入你昵称",trigger:"blur"}],roleIdList:[{required:!0,message:"请选择角色",trigger:"blur"}]}),$=y([]);de(()=>{I()});async function I(){let d=await m.$api.sys_dept.tree();$.value=d.body}function B(d){p.value.dept_id=d.id,V()}async function V(){m.$refs.baseTableRef.refresh()}function E(){n.value={sex:0,dept_id:p.value.dept_id},c.value="add",s.value=!0}function M(d){n.value=Object.assign({},d),n.value.password=null,c.value="update",s.value=!0}async function Q(d){let l=await m.$api.sys_user.delete(d);m.submitOk(l.messge),V()}async function z(d){n.value=Object.assign({},d),c.value="updatePwd",g.value="123456",s.value=!0}async function A(){n.value.password=g.value;let d=await m.$api.sys_user.update(n.value);m.submitOk(d.msg,()=>{H()}),s.value=!1}function G(){m.$refs.dataFormRef.validate(async d=>{if(d){let l=await m.$api.sys_user[n.value.id?"update":"add"](n.value);m.submitOk(l.msg),V(),s.value=!1}})}function H(){n.value.id===S.value.id&&R()}return(d,l)=>{const J=u("el-tree"),K=u("base-card"),N=u("base-cascader"),C=u("base-input"),v=u("el-button"),W=u("base-header"),_=u("el-table-column"),O=u("el-tag"),X=u("base-delete-btn"),Y=u("base-table-p"),Z=u("base-content"),ee=u("base-card-no"),k=u("base-input-no"),h=u("base-dialog"),b=u("el-form-item"),P=u("base-select"),le=u("el-option"),ae=u("el-select"),te=u("base-upload-single"),oe=u("el-form"),ne=u("base-wrapper"),L=re("has-perm");return r(),i(ne,{class:"flex"},{default:o(()=>[a(K,{title:"组织架构",style:{width:"200px"}},{default:o(()=>[a(J,{data:t($),props:{children:"children",label:"name"},"highlight-current":"","default-expand-all":"","expand-on-click-node":!1,onNodeClick:B},null,8,["data"])]),_:1}),a(ee,{title:"用户管理",class:"flex-1"},{default:o(()=>[a(W,null,{default:o(()=>[a(N,{modelValue:t(p).dept_id,"onUpdate:modelValue":l[0]||(l[0]=e=>t(p).dept_id=e),style:{"margin-right":"10px"},clearable:"",label:"企业",props:{value:"id",label:"name",children:"children",checkStrictly:!0,emitPath:!1},api:"sys_dept.tree"},null,8,["modelValue"]),a(C,{modelValue:t(p).username,"onUpdate:modelValue":l[1]||(l[1]=e=>t(p).username=e),label:"账号",onClear:V},null,8,["modelValue"]),a(C,{modelValue:t(p).nickname,"onUpdate:modelValue":l[2]||(l[2]=e=>t(p).nickname=e),label:"名称 ",onClear:V},null,8,["modelValue"]),a(C,{modelValue:t(p).phone,"onUpdate:modelValue":l[3]||(l[3]=e=>t(p).phone=e),label:"手机号",onClear:V},null,8,["modelValue"]),j((r(),i(v,{type:"primary",onClick:V},{default:o(()=>[f("查询")]),_:1})),[[L,"sys:user:page"]]),j((r(),i(v,{type:"success",onClick:E},{default:o(()=>[f("添加")]),_:1})),[[L,"sys:user:add"]])]),_:1}),a(Z,null,{default:o(()=>[a(Y,{ref:"baseTableRef",api:"sys_user.listPage",params:t(p),indexCode:!0},{default:o(()=>[a(_,{"show-overflow-tooltip":!0,prop:"username",label:"用户账号"}),a(_,{prop:"nickname",label:"用户名称"}),a(_,{prop:"sexName",label:"性别"}),a(_,{prop:"phone",label:"手机号码"}),a(_,{prop:"email",label:"邮箱"}),a(_,{prop:"accounttypename",label:"账户类型"},{default:o(e=>[e.row.accounttypename?(r(),i(O,{key:0,type:"success"},{default:o(()=>[f(D(e.row.accounttypename),1)]),_:2},1024)):w("",!0)]),_:1}),a(_,{label:"角色","show-overflow-tooltip":!0},{default:o(e=>[e.row.roleNames?(r(),i(O,{key:0},{default:o(()=>[f(D(e.row.roleNames),1)]),_:2},1024)):w("",!0)]),_:1}),a(_,{label:"头像",prop:"avatarUrl"},{default:o(e=>[F("span",null,[F("img",{src:e.row.avatar_url,alt:"",class:"img-sm"},null,8,_e)])]),_:1}),a(_,{"show-overflow-tooltip":!0,prop:"deptName",label:"归属企业"}),a(_,{label:"操作",width:"230"},{default:o(e=>[a(v,{link:"",onClick:T=>M(e.row)},{default:o(()=>[f("编辑")]),_:2},1032,["onClick"]),e.row.isFixed?w("",!0):(r(),i(X,{key:0,onOk:T=>Q(e.row.id)},null,8,["onOk"])),a(v,{link:"",onClick:T=>z(e.row)},{default:o(()=>[f("更新密码")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["params"])]),_:1})]),_:1}),t(c)==="updatePwd"?(r(),i(h,{key:0,modelValue:t(s),"onUpdate:modelValue":l[7]||(l[7]=e=>U(s)?s.value=e:s=e),title:d.dialogTitleObj[t(c)],width:"30%"},{footer:o(()=>[a(v,{onClick:l[5]||(l[5]=e=>U(s)?s.value=!1:s=!1)},{default:o(()=>[f("取消")]),_:1}),a(v,{type:"primary",onClick:l[6]||(l[6]=e=>A())},{default:o(()=>[f("确定")]),_:1})]),default:o(()=>[a(k,{modelValue:t(g),"onUpdate:modelValue":l[4]||(l[4]=e=>U(g)?g.value=e:g=e),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1},8,["modelValue","title"])):(r(),i(h,{key:1,modelValue:t(s),"onUpdate:modelValue":l[19]||(l[19]=e=>U(s)?s.value=e:s=e),title:d.dialogTitleObj[t(c)],width:"20%"},{footer:o(()=>[a(v,{onClick:l[18]||(l[18]=e=>U(s)?s.value=!1:s=!1)},{default:o(()=>[f("取消")]),_:1}),a(v,{type:"primary",onClick:G},{default:o(()=>[f("确定")]),_:1})]),default:o(()=>[a(oe,{ref:"dataFormRef",model:t(n),rules:t(q),"label-width":"80px"},{default:o(()=>[a(b,{label:"账号:",prop:"username"},{default:o(()=>[a(k,{modelValue:t(n).username,"onUpdate:modelValue":l[8]||(l[8]=e=>t(n).username=e),disabled:t(c)!="add"},null,8,["modelValue","disabled"])]),_:1}),t(c)==="add"?(r(),i(b,{key:0,label:"密码:",prop:"password"},{default:o(()=>[a(k,{modelValue:t(n).password,"onUpdate:modelValue":l[9]||(l[9]=e=>t(n).password=e)},null,8,["modelValue"])]),_:1})):w("",!0),a(b,{label:"昵称:",prop:"nickname"},{default:o(()=>[a(k,{modelValue:t(n).nickname,"onUpdate:modelValue":l[10]||(l[10]=e=>t(n).nickname=e)},null,8,["modelValue"])]),_:1}),a(b,{label:"角色:",prop:"roleIdList"},{default:o(()=>[t(s)?(r(),i(P,{key:0,modelValue:t(n).roleIdList,"onUpdate:modelValue":l[11]||(l[11]=e=>t(n).roleIdList=e),"tag-type":"warning",multiple:"",style:{width:"100%"},"option-props":{label:"name",value:"id"},api:"sys_role.list"},null,8,["modelValue"])):w("",!0)]),_:1}),a(b,{label:"性别:",prop:"sex"},{default:o(()=>[a(ae,{modelValue:t(n).sex,"onUpdate:modelValue":l[12]||(l[12]=e=>t(n).sex=e),placeholder:"请选择"},{default:o(()=>[(r(!0),ie(pe,null,me(d.sexList,e=>(r(),i(le,{key:e.value,label:e.name,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(b,{label:"手机号码:",prop:"phone"},{default:o(()=>[a(k,{modelValue:t(n).phone,"onUpdate:modelValue":l[13]||(l[13]=e=>t(n).phone=e),oninput:"value=value.replace(/[^\\d]/g,'')"},null,8,["modelValue"])]),_:1}),a(b,{label:"邮箱:",prop:"email"},{default:o(()=>[a(k,{modelValue:t(n).email,"onUpdate:modelValue":l[14]||(l[14]=e=>t(n).email=e)},null,8,["modelValue"])]),_:1}),a(b,{label:"头像:",prop:"avatarUrl"},{default:o(()=>[a(te,{modelValue:t(n).avatar_url,"onUpdate:modelValue":l[15]||(l[15]=e=>t(n).avatar_url=e)},null,8,["modelValue"])]),_:1}),a(b,{label:"归属企业:"},{default:o(()=>[t(s)?(r(),i(N,{key:0,modelValue:t(n).dept_id,"onUpdate:modelValue":l[16]||(l[16]=e=>t(n).dept_id=e),clearable:"",style:{width:"100%"},placeholder:"请选择",props:{value:"id",label:"name",children:"children",checkStrictly:!0,emitPath:!1},api:"sys_dept.tree"},null,8,["modelValue"])):w("",!0)]),_:1}),a(b,{label:"岗位:",prop:"post_idlist"},{default:o(()=>[t(s)?(r(),i(P,{key:0,modelValue:t(n).post_idlist,"onUpdate:modelValue":l[17]||(l[17]=e=>t(n).post_idlist=e),"tag-type":"success",style:{width:"100%"},multiple:"",clearable:"","option-props":{label:"name",value:"id"},api:"sys_post.list"},null,8,["modelValue"])):w("",!0)]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]))]),_:1})}}};export{ce as default};
