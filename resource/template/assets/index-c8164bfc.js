import{_ as z,g as O,r as _,t as T,f as j,h as E,o as M,a as s,b as w,c as V,w as n,e as m,d as l,i as v,u as f,j as y,k as Q,p as W,l as D}from"./index-b2871155.js";function G(i,o,c){return!o||o.length<6?c(new Error("密码最少6位")):c()}const H=i=>(W("data-v-9f9adb14"),i=i(),D(),i),J={class:"flex-c-center-center bg-color-white",style:{height:"400px",width:"500px","border-radius":"10px"}},K={class:"m-t-20"},X=H(()=>m("h1",{class:"font-size-base",style:{"padding-bottom":"20px","padding-left":"100px"}},"后台管理系统",-1)),Y={style:{"text-align":"center"}},Z={__name:"index",setup(i){const{proxy:o}=O();let c=o.$store.user.useUserStore();const{init:k,verCaptcha:F,login:C,getCaptcha:U}=c,t=_({});let u=_(!1),g=_(""),p=_();const{orcode:x,versu:q}=T(c),S={code:[{required:!0,trigger:"change",message:"请输入Authenticator验证码"}],username:[{required:!0,trigger:"change",message:"请输入账号"}],password:[{required:!0,trigger:"change",validator:G}]};j(async()=>{}),E(()=>o.$router.currentRoute.value,r=>{console.log("路由变化：",r.path)},{immediate:!0}),M(async()=>{k()});function I(){o.$refs.loginFormRef.validate(r=>{r&&C(t.value).then(()=>{let e=o.$route.fullPath;if(e.startsWith("/login?redirect=")){let d=e.replace("/login?redirect=","");o.$router.push({path:d})}else o.$router.push({path:"/"})})})}function R(){t.value.username!=null?U(t.value).then(()=>{g.value="qrcode",u.value=!0}):o.submitInfo("请输入账号!")}function N(){let r=x.value.toString(),e=r.substring(r.indexOf("=")+1,r.length);t.value.code=p,t.value.twocode=e,F(t.value).then(()=>{q.value==1?(g.value="qrcode",u.value=!1,o.submitOk("绑定成功")):o.submitFail("验证码错误!")})}return(r,e)=>{const d=s("base-input-no"),h=s("el-form-item"),P=s("el-link"),$=s("el-form"),b=s("el-button"),A=s("base-qrcode"),B=s("base-dialog"),L=s("base-wrapper");return w(),V(L,{class:"flex-center-center",style:{"background-color":"#FFFFFF"}},{default:n(()=>[m("div",J,[m("div",K,[X,l($,{ref:"loginFormRef",model:t.value,rules:S},{default:n(()=>[l(h,{prop:"username"},{default:n(()=>[l(d,{modelValue:t.value.username,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.username=a),"prefix-icon":"User",placeholder:"请输入账号",maxlength:"30"},null,8,["modelValue"])]),_:1}),l(h,{prop:"password"},{default:n(()=>[l(d,{modelValue:t.value.password,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.password=a),"prefix-icon":"Lock",placeholder:"请输入密码","show-password":"",maxlength:"30"},null,8,["modelValue"])]),_:1}),l(h,{prop:"code"},{default:n(()=>[l(d,{modelValue:t.value.code,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.code=a),"prefix-icon":"Lock",placeholder:"请输入Authenticator验证码",maxlength:"6",onkeyup:"value=value.replace(/[^\\d.]/g,'')"},null,8,["modelValue"]),l(P,{type:"primary",onClick:R},{default:n(()=>[v("首次登录绑定&更换手机")]),_:1})]),_:1})]),_:1},8,["model"]),l(b,{type:"primary",style:{width:"300px"},onClick:I},{default:n(()=>[v("登 录")]),_:1})])]),f(g)==="qrcode"?(w(),V(B,{key:0,modelValue:f(u),"onUpdate:modelValue":e[4]||(e[4]=a=>y(u)?u.value=a:u=a),title:"绑定账号"+t.value.username,width:"15%"},{default:n(()=>[m("div",Y,[l(A,{value:f(x),size:"200"},null,8,["value"])]),m("span",null,[l(d,{modelValue:f(p),"onUpdate:modelValue":e[3]||(e[3]=a=>y(p)?p.value=a:p=a),placeholder:"请使用Authenticator扫码后显示的验证码",maxlength:"6",onkeyup:"value=value.replace(/[^\\d.]/g,'')"},null,8,["modelValue"]),l(b,{type:"primary",class:"m-t-10 w-full",onClick:N},{default:n(()=>[v("确定绑定")]),_:1})])]),_:1},8,["modelValue","title"])):Q("",!0)]),_:1})}}},te=z(Z,[["__scopeId","data-v-9f9adb14"]]);export{te as default};
